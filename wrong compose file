version: '3.3'

services:
  yelb-ui:
    image: mreferre/yelb-ui:0.7
    expose:
      - "80"
    networks:
      - yelb-network

  yelb-appserver:
    image: mreferre/yelb-appserver:0.5
    ports:
      - "4567:4567"
    depends_on:
      - yelb-db
      - redis
    networks:
      - yelb-network

  yelb-db:
    image: mreferre/yelb-db:0.5
    networks:
      - yelb-network
    volume:
      - local:/var/lib/postgresql/data
  odilia-db-replication01:
    image: mreferre/yelb-db:0.5
    networks:
      - yelb-network
    volume:
      - local:/var/lib/postgresql/data

  odilia-db-replication02:
    image: mreferre/yelb-db:0.5
    networks:
      - yelb-network
    volume:
      - local:/var/lib/postgresql/data

  odilia-db-replication03:
    image: mreferre/yelb-db:0.5
    networks:
      - yelb-network
    volume:
      - local:/var/lib/postgresql/data

  redis:
    image: redis:4.0.2
    ports:
      - "6379:6379"
    volumes:
      - ./redis-server.conf:/etc/redis/redis.conf
    command: ["redis-server", "/etc/redis/redis.conf"]
    networks:
      - yelb-network
  odilia-redis01:
    image: redis:4.0.2
    ports:
      - "6379:6379"
    volumes:
      - ./odilia-redis01.conf:/etc/redis/redis.conf
    command: ["redis-server", "/etc/redis/redis.conf"]
    networks:
      - yelb-network
  odilia-redis02:
    image: redis:4.0.2
    ports:
      - "6379:6379"
    volumes:
      - ./odilia-redis02.conf:/etc/redis/redis.conf
    command: ["redis-server", "/etc/redis/redis.conf"]
    networks:
      - yelb-network
  odilia-redis-sentinel01:
    image: redis:4.0.2
    ports:
      - "26379:26379"  
    volumes:
      - ./Odilia-redis-sentinel01:/etc/redis/sentinel.conf
    command: ["redis-sentinel", "/etc/redis/sentinel.conf"]
    networks:
      - yelb-network
  depends_on:
      - redis-server
      - odilia-redis01
      - odilia-redis02

  odilia-redis-sentinel02:
    image: redis:4.0.2
    ports:
      - "26380:26379"  # Change the port if necessary
    volumes:
      - ./Odilia-redis-sentinel02:/etc/redis/sentinel.conf
    command: ["redis-sentinel", "/etc/redis/sentinel.conf"]
    networks:
      - yelb-network
    depends_on:
      - redis-server
      - odilia-redis01
      - odilia-redis02

  odilia-redis-sentinel03:
    image: redis:4.0.2
    ports:
      - "26381:26379"  # Change the port if necessary
    volumes:
      - ./Odilia-redis-sentinel03:/etc/redis/sentinel.conf
    command: ["redis-sentinel", "/etc/redis/sentinel.conf"]
    networks:
      - yelb-network
    depends_on:
      - redis-server
      - odilia-redis01
      - odilia-redis02
      
networks:
  yelb-network:
    driver: bridge

volumes:
  yelb-data:
    driver: local
  redis:
    driver: local
  odilia-redis01:
    driver: local
  odilia-redis02:
    driver: local
  odilia-redis-sentinel01:
    driver: local
  odilia-redis-sentinel02:
    driver: local
  odilia-redis-sentinel03:
    driver: local


